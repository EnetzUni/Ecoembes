package es.deusto.sd.ecoembes.service;

import java.util.Date;
import java.util.HashMap;
import java.util.Map;
import java.util.Optional;

import org.springframework.stereotype.Service;

import es.deusto.sd.ecoembes.entity.Employee;

@Service
public class AuthService {

    // Simulamos la "state" del servidor: tokens en memoria
    private Map<String, Employee> loggedInEmployees = new HashMap<>();

    /**
     * Login de un empleado
     * @param email
     * @param password
     * @param employeeData (usualmente proviene de EmployeeRepository)
     * @return token
     */
    public String login(Employee employee, String password) {
        if (employee != null && employee.getPassword().equals(password)) {
            String token = String.valueOf(new Date().getTime()); // simple token
            loggedInEmployees.put(token, employee);
            return token;
        }
        throw new RuntimeException("Invalid credentials");
    }

    /**
     * Logout del empleado
     */
    public void logout(String token) {
        loggedInEmployees.remove(token);
    }

    /**
     * Devuelve el empleado asociado a un token
     */
    public Optional<Employee> getEmployeeByToken(String token) {
        return Optional.ofNullable(loggedInEmployees.get(token));
    }

    /**
     * Verifica que un token sea v√°lido
     */
    public boolean isTokenValid(String token) {
        return loggedInEmployees.containsKey(token);
    }
}
